<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Study Planner</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> 
</head>
<body>
    <center><h1>BrainBoost â€“ Plan, learn, excel !!!</h1></center>

    <div class="container">
        <h3>AI-Powered Study Plan Generator</h3>
        <div class="input-section">
            
            <label for="course">Course Name:</label>
            <input type="text" id="course" placeholder="Enter course name">

            <label for="exam-date">Duration (Months):</label>
            <input type="number" id="exam-date">

            <label for="skill-level">Skill Level:</label>
            <select id="skill-level">
                <option value="beginner" selected>Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
            </select>

            <div id="weak-areas-section">
                <label for="weak-areas">Area you need to focus:</label>
                <textarea id="weak-areas" placeholder="List your weak topics..."></textarea>
            </div>    

            <button id="generate-btn">Generate Study Plan</button>
        </div>
    </div><br><br>
    
    <div id="loader" class="loader" style="display: none;"></div>
    <div class="output-section" id="output-section" style="display: none;">
        <h2>Your Study Plan</h2>
        <div id="study-plan" class="study-plan"></div><br>
        <button id="download-btn">Download as Image</button>
    </div>

    <script>
        document.getElementById('skill-level').addEventListener('change', function() {
            const weakAreasSection = document.getElementById('weak-areas-section');
            weakAreasSection.style.display = this.value === 'beginner' ? 'none' : 'block';
        });

        document.getElementById('generate-btn').addEventListener('click', async function() {
            const course = document.getElementById('course').value;
            const examDate = document.getElementById('exam-date').value;
            const skillLevel = document.getElementById('skill-level').value;
            const weakAreas = document.getElementById('weak-areas').value;
            const outputSection = document.getElementById('output-section');
            const studyPlanDiv = document.getElementById('study-plan');
            const loader = document.getElementById('loader');

            if (!course || !examDate) {
                alert('Please fill in all fields!');
                return;
            }

            let prompt = `Generate a structured study plan for '${course}', duration: '${examDate}' months.always include  topic that need to be covered in that week,finally mention the website name where can learn this `;

            if (skillLevel === 'beginner') {
                prompt += " The user is a beginner. Provide a study plan from zero to advanced.";
            } else if (skillLevel === 'advanced') {
                prompt += " The user is advanced. Provide a study plan covering the most important topics and provide them a challenge.";
            } else {
            
                prompt += ` The user is intermediate. Weak areas: ${weakAreas}. Provide a study plan focusing on these weak areas.`;
            }
            loader.style.display = 'block';
            const apiKey = 'AIzaSyBo6SyP51q7O8J0kP853PvfmMhlXWqN4yQ';
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    console.error('Error response body:', errorBody);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                if (data.candidates && data.candidates.length > 0 && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts.length > 0) {
                    const rawText = data.candidates[0].content.parts[0].text;
                    const formattedHtml = marked.parse(rawText);
                    studyPlanDiv.innerHTML = formattedHtml;
                } else {
                    studyPlanDiv.innerHTML = "<p style='color: red;'>Failed to generate study plan. The response from the AI was not in the expected format.</p>";
                    console.error('Unexpected AI response format:', data);
                }
                outputSection.style.display = 'block';

            } catch (error) {
                console.error('Error fetching AI response:', error);
                studyPlanDiv.innerHTML = "<p style='color: red;'>Failed to generate study plan. Try again.</p>";
            }
            loader.style.display = 'none';
        });

        document.getElementById('download-btn').addEventListener('click', function() {
            html2canvas(document.getElementById('study-plan'), {
                scale: 3,
                useCORS: true,
                backgroundColor: "#1e1e1e"
            }).then(canvas => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL("image/png", 1.0);
                link.download = `${document.getElementById('course').value}-study plan.png`;
                link.click();
            });
        });
        document.getElementById('weak-areas-section').style.display = 'none';

    </script>

</body>
</html>
